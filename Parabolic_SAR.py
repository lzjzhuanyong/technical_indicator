klines = [
    [1567900800000,"10000","10412.65","10000","10391.63","3096.291",1567987199999,"32096280.44997",3754,"0.039","393.35627","0"],
    [1567987200000,"10316.62","10475.54","10077.22","10307","14824.373",1568073599999,"152447209.57153",11296,"5452.451","56197395.22191","0"],
    [1568073600000,"10307","10382.97","9940.87","10102.02","9068.955",1568159999999,"92717645.17470",10089,"6395.462","65526356.95107","0"],
    [1568160000000,"10094.27","10293.11","9884.31","10159.55","10897.922",1568246399999,"109786235.83974",13811,"7724.442","77841159.69945","0"],
    [1568246400000,"10163.06","10450.13","10042.12","10415.13","15609.634",1568332799999,"159494237.43414",20060,"10117.798","103160660.48429","0"],
    [1568332800000,"10414.96","10440.55","10153.51","10341.34","19252.721",1568419199999,"198205401.80487",29249,"9717.128","100083062.05222","0"],
    [1568419200000,"10343.01","10419.97","10222.77","10332.25","20656.624",1568505599999,"213270510.33553",30436,"9522.547","98347059.96283","0"],
    [1568505600000,"10333.47","10359.20","10024.81","10302.22","20536.255",1568591999999,"211512546.03807",25912,"7430.161","76527442.09982","0"],
    [1568592000000,"10302","10353.81","10080.70","10249.27","20185.637",1568678399999,"206767492.67183",31837,"6954.582","71177496.13928","0"],
    [1568678400000,"10257.30","10270.63","10136.77","10186.52","22519.607",1568764799999,"229911548.18276",31535,"12669.109","129336069.82540","0"],
    [1568764800000,"10183.87","10256.65","10097.92","10155.16","20832.895",1568851199999,"212309755.01688",30799,"13464.203","137250597.56858","0"],
    [1568851200000,"10154.70","10331.62","9530.02","10245.30","26228.754",1568937599999,"262112110.02615",41871,"10213.792","102471541.32640","0"],
    [1568937600000,"10247.70","10279.30","10070.50","10166.35","23265.910",1569023999999,"236683803.67808",31054,"9517.128","96905407.08332","0"],
    [1569024000000,"10166.56","10175.30","9912.63","9983.33","23642.387",1569110399999,"237320660.25696",32670,"8219.618","82449521.73411","0"],
    [1569110400000,"9992.70","10089.52","9857","10023.04","23916.354",1569196799999,"238688620.33846",33401,"10466.395","104504245.65882","0"],
    [1569196800000,"10027.69","10046.91","9620","9701.96","31927.062",1569283199999,"314749491.62710",42190,"14924.551","147226975.18317","0"],
    [1569283200000,"8683.20","9792.83","8645.61","8645.61","29758.535",1569369599999,"286175252.41143996",46730,"14817.318","142461498.10542","0"],
    [1569369600000,"8493.32","8725.24","8200","8430.07","48222.102",1569455999999,"406841550.16218",85707,"24972.130","210761781.75501","0"],
    [1569456000000,"8428.15","8464.40","7700.67","8060.15","60065.945",1569542399999,"487919029.55307",110581,"29931.388","243327659.90662","0"],
    [1569542400000,"8061.98","8260","7851.94","8176.52","40034.653",1569628799999,"321440849.10520",80396,"20960.862","168269237.30284","0"],
    [1569628800000,"8178.26","8311","8001.14","8195.38","33820.919",1569715199999,"275406180.40421",69220,"16862.162","137291433.18531","0"],
    [1569715200000,"8199","8226.35","7888.98","8041.96","35966.056",1569801599999,"289320913.71819",78128,"20057.619","161475890.51235","0"],
    [1569801600000,"8042.08","8331.89","7709.01","8285.84","54412.520",1569887999999,"436701925.16117",107329,"27935.359","224211005.55634","0"],
    [1569888000000,"8285.31","8499","8171","8290","39212.804",1569974399999,"327218811.62991",92166,"19547.744","163152006.75129","0"],
    [1569974400000,"8290","8365.92","8149.35","8352.14","30329.179",1570060799999,"249785989.08192",71452,"13840.600","113978670.61272","0"],
    [1570060800000,"8353.40","8386","8020","8220.27","33430.230",1570147199999,"274334928.39047",82221,"15177.823","124513346.44436","0"],
    [1570147200000,"8219.95","8227.42","7979.95","8130.56","28421.111",1570233599999,"230978393.31482",74683,"12437.976","101062599.15354","0"],
    [1570233600000,"8130","8175","8010","8122.14","30262.006",1570319999999,"244744089.06028",69791,"12199.701","98632706.00080","0"],
    [1570320000000,"8122.01","8148.43","7760","7852.79","41909.039",1570406399999,"333155725.01068",94844,"19790.528","157345906.89689","0"],
    [1570406400000,"7851.01","8330","7764.42","8186.88","62760.299",1570492799999,"504822438.82757",115400,"30547.437","246020207.22784","0"]
    ]



sar = [None]*len(klines)


previous_SAR = None
previous_AF = 0.02
previous_EP = None
current_EP = None
current_AF = None
uptrend = None



previous_low = the_day_before_low = float(klines[0][3])
previous_high = the_day_before_high = float(klines[0][2])
current_low = float(klines[1][3])
current_high = float(klines[1][2])

current_close = float(klines[1][4])
previous_close = float(klines[1][4])

# initial
if current_close > previous_close:
    uptrend = True
    previous_SAR = current_EP = current_low
    previous_EP = previous_high
else:
    uptrend = False
    previous_SAR = current_EP = current_high
    previous_EP = previous_low


for i in range(1,len(klines)):
    FirstEnter = False

    previous_low = float(klines[i-1][3])
    previous_high = float(klines[i-1][2])
    current_low = float(klines[i][3])
    current_high = float(klines[i][2])
    if i > 1: 
        the_day_before_low = float(klines[i-2][3])
        the_day_before_high = float(klines[i-2][2])

        
    # step1
    current_SAR = previous_SAR + previous_AF * ( previous_EP - previous_SAR)

    # step2

    if uptrend:
        if current_SAR > current_low:
            FirstEnter = True
            uptrend = False
            current_SAR = previous_EP
            current_EP = current_low
            current_AF = 0.02
    else:
        if current_SAR < current_high:
            FirstEnter = True
            uptrend = True
            current_SAR = previous_EP
            current_EP = current_high
            current_AF = 0.02

    if not FirstEnter:

        if uptrend:
            if current_EP < current_high:
                current_EP = current_high
                current_AF = min(current_AF + 0.02 , 0.2)
        else:
            if current_EP > current_low:
                current_EP = current_low
                current_AF = min(current_AF + 0.02 , 0.2)

    if uptrend:
        current_SAR = min(current_SAR, previous_low, the_day_before_low)
    else:
        current_SAR = max(current_SAR, previous_high, the_day_before_high)

    sar[i] = current_SAR

    previous_AF = current_AF
    previous_SAR = current_SAR
    previous_EP = current_EP

    

print(sar)
